import numpy as np
from pyscf import gto, scf
import re

##### Geometries for 67 Molecules #####

# Given input string

input_string = """
# Geometry given in units of Bohr.
h spin 1 H 0.0000000000 0.0000000000 0.0000000000
li spin 1 Li 0.0000000000 0.0000000000 0.0000000000
be spin 0 BE 0.0000000000 0.0000000000 0.0000000000
c spin 2 C 0.0000000000 0.0000000000 0.0000000000
n spin 3 N 0.0000000000 0.0000000000 0.0000000000
o spin 2 O 0.0000000000 0.0000000000 0.0000000000
f spin 1 F 0.0000000000 0.0000000000 0.0000000000
na spin 1 NA 0.0000000000 0.0000000000 0.0000000000
si spin 2 SI 0.0000000000 0.0000000000 0.0000000000
p spin 3 P 0.0000000000 0.0000000000 0.0000000000
s spin 2 S 0.0000000000 0.0000000000 0.0000000000
cl spin 1 CL 0.0000000000 0.0000000000 0.0000000000
li_h spin 0 LI 0.0000000000 0.0000000000 0.7538116965 H 0.0000000000 0.0000000000 -2.2616240621
be_h spin 1 BE 0.0000000000 0.0000000000 1.2674392200 H 0.0000000000 0.0000000000 -1.2674392200
c_h spin 1 C 0.0000000000 0.0000000000 0.3017892402 H 0.0000000000 0.0000000000 -1.8107354414
c_h2_triplet spin 2 C 0.0000000000 0.0000000000 0.1989314547 H 0.0000000000 -1.8701484265 -0.5968132614 H 0.0000000000 1.8701484265 -0.5968132614
c_h2_singlet spin 0 C 0.0000000000 0.0000000000 0.3278296643 H 0.0000000000 -1.6279989384 -0.9834700958 H 0.0000000000 1.6279989384 -0.9834700958
c_h3 spin 1 C 0.0000000000 0.0000000000 0.0000000000 H -1.0167670677 1.7610922207 0.0000000000 H -1.0167670677 -1.7610922207 0.0000000000 H 2.0335341354 0.0000000000 0.0000000000
c_h4 spin 0 C 0.0000000000 0.0000000000 0.0000000000 H 1.1849715779 -1.1849715779 -1.1849715779 H -1.1849715779 1.1849715779 -1.1849715779 H -1.1849715779 -1.1849715779 1.1849715779 H 1.1849715779 1.1849715779 1.1849715779
n_h spin 2 N 0.0000000000 0.0000000000 0.2447195154 H 0.0000000000 0.0000000000 -1.7130366079
n_h2 spin 1 N 0.0000000000 0.0000000000 0.2676985834 H -1.5144075093 0.0000000000 -0.9369261447 H 1.5144075093 0.0000000000 -0.9369261447
n_h3 spin 0 N 0.0000000000 0.0000000000 0.2149752284 H -0.8857051218 1.5340862715 -0.5016466607 H -0.8857051218 -1.5340862715 -0.5016466607 H 1.7714102436 0.0000000000 -0.5016466607
o_h spin 1 O 0.0000000000 0.0000000000 0.2035990779 H 0.0000000000 0.0000000000 -1.6288682124
h2_o spin 0 H -1.4308249289 0.0000000000 -0.8863003855 H 1.4308249289 0.0000000000 -0.8863003855 O 0.0000000000 0.0000000000 0.2215703721
h_f spin 0 H 0.0000000000 0.0000000000 -1.5592507070 F 0.0000000000 0.0000000000 0.1732500786
si_h2_singlet spin 0 SI 0.0000000000 0.0000000000 0.2474879640 H -2.0687699662 0.0000000000 -1.7324195273 H 2.0687699662 0.0000000000 -1.7324195273
si_h2_triplet spin 2 SI 0.0000000000 0.0000000000 0.1786148217 H -2.3899151028 0.0000000000 -1.2503037516 H 2.3899151028 0.0000000000 -1.2503037516
si_h3 spin 1 SI 0.0000000000 0.0000000000 0.1496228345 H -1.3303500878 2.3042339440 -0.6982386347 H -1.3303500878 -2.3042339440 -0.6982386347 H 2.6607001756 0.0000000000 -0.6982386347
si_h4 spin 0 SI 0.0000000000 0.0000000000 0.0000000000 H 1.6111331340 -1.6111331340 -1.6111331340 H -1.6111331340 1.6111331340 -1.6111331340 H -1.6111331340 -1.6111331340 1.6111331340 H 1.6111331340 1.6111331340 1.6111331340
p_h2 spin 1 P 0.0000000000 0.0000000000 -0.2185600386 H -1.9277661719 0.0000000000 1.6391993444 H 1.9277661719 0.0000000000 1.6391993444
p_h3 spin 0 P 0.0000000000 0.0000000000 0.2409778580 H -1.1208437265 1.9413582816 -1.2049081870 H -1.1208437265 -1.9413582816 -1.2049081870 H 2.2416874529 0.0000000000 -1.2049081870
h2_s spin 0 H -1.8156865235 0.0000000000 -1.5585704056 H 1.8156865235 0.0000000000 -1.5585704056 S 0.0000000000 0.0000000000 0.1948307493
h_cl spin 0 H 0.0000000000 0.0000000000 -2.2744741988 CL 0.0000000000 0.0000000000 0.1337925999
li2 spin 0 LI 0.0000000000 0.0000000000 -2.5256187826 LI 0.0000000000 0.0000000000 2.5256187826
li_f spin 0 F 0.0000000000 0.0000000000 1.4776712361 LI 0.0000000000 0.0000000000 -1.4776712361
c2_h2 spin 0 C 0.0000000000 0.0000000000 -1.1361032638 C 0.0000000000 0.0000000000 1.1361032638 H 0.0000000000 0.0000000000 -3.1439371258 H 0.0000000000 0.0000000000 3.1439371258
c2_h4 spin 0 C 0.000000000 0.000000000 0.000000000 C 0.000000000 0.000000000 2.508023735 H 1.740983898 0.000000000 -1.085783723 H -1.740983898 0.000000000 -1.085783723 H 1.740983898 0.000000000 3.593807457 H -1.740983898 0.000000000 3.593807457
c2_h6 spin 0 C 0.0000000000 0.0000000000 -1.4386483945 C 0.0000000000 0.0000000000 1.4386483945 H -1.6617535925 -0.9594138840 2.1829169747 H 1.6617535925 -0.9594138840 2.1829169747 H 0.0000000000 -1.9188277679 -2.1829169747 H 1.6617535925 0.9594138840 -2.1829169747 H -1.6617535925 0.9594138840 -2.1829169747 H 0.0000000000 1.9188277679 2.1829169747
c_n spin 1 C 0.0000000000 0.0000000000 1.1073794288 N 0.0000000000 0.0000000000 -1.1073794288
h_c_n spin 0 H 0.0000000000 0.0000000000 -2.8401825705 C 0.0000000000 0.0000000000 -0.8276999826 N 0.0000000000 0.0000000000 1.3516076155
c_o spin 0 C 0.0000000000 0.0000000000 1.0752540870 O 0.0000000000 0.0000000000 -1.0752540870
h_c_o spin 1 H 1.767383372 0.000000000 -1.193700313 C 0.000000000 0.000000000 0.000000000 O 0.000000000 0.000000000 2.222716663
h2_c_o spin 0 H -1.7690669834 0.0000000000 -2.0934384492 H 1.7690669834 0.0000000000 -2.0934384492 C 0.0000000000 0.0000000000 -1.0008555749 O 0.0000000000 0.0000000000 1.2739965691
h3_c_o_h spin 0 H -2.0540490007 1.8442554010 0.0000000000 H 1.6262830672 -1.9975140683 0.0000000000 H 0.8279739929 2.0250190301 -1.6809849654 H 0.8279739929 2.0250190301 1.6809849654 C -0.0877267495 1.2530187210 0.0000000000 O -0.0877267495 -1.4268621735 0.0000000000
n2 spin 0 N 0.0000000000 0.0000000000 -1.0370816221 N 0.0000000000 0.0000000000 1.0370816221
n2_h4 spin 0 N 0.1122505457 1.3501196282 -0.0803855930 N -0.1122505457 -1.3501196282 -0.0803855930 H 0.5895561278 2.0205227427 1.6458351020 H -0.5895561278 -2.0205227427 1.6458351020 H -1.5986022854 2.0625696108 -0.5287677360 H 1.5986022854 -2.0625696108 -0.5287677360
n_o spin 1 N 0.0000000000 0.0000000000 -1.1598382222 O 0.0000000000 0.0000000000 1.0148584444
o2 spin 2 O 0.0000000000 0.0000000000 -1.1409220651 O 0.0000000000 0.0000000000 1.1409220651
h2_o2 spin 0 H -1.6869016975 -1.4931291947 0.8801398788 H 1.6869016975 1.4931291947 0.8801398788 O -1.3709962041 0.0000000000 -0.1100198470 O 1.3709962041 0.0000000000 -0.1100198470
f2 spin 0 F 0.0000000000 0.0000000000 -1.3339575747 F 0.0000000000 0.0000000000 1.3339575747
c_o2 spin 0 C 0.0000000000 0.0000000000 0.0000000000 O 0.0000000000 0.0000000000 -2.1920821458 O 0.0000000000 0.0000000000 2.1920821458
na2 spin 0 NA 0.0000000000 0.0000000000 -2.9091386718 NA 0.0000000000 0.0000000000 2.9091386718
si2 spin 2 SI 0.0000000000 0.0000000000 -2.1221622842 SI 0.0000000000 0.0000000000 2.1221622842
p2 spin 0 P 0.0000000000 0.0000000000 -1.7890035926 P 0.0000000000 0.0000000000 1.7890035926
s2 spin 2 S 0.0000000000 0.0000000000 -1.7850351680 S 0.0000000000 0.0000000000 1.7850351680
cl2 spin 0 CL 0.0000000000 0.0000000000 -1.8782931455 CL 0.0000000000 0.0000000000 1.8782931455
na_cl spin 0 NA 0.0000000000 0.0000000000 0.0000000000 CL 0.0000000000 0.0000000000 4.4612651118
si_o spin 0 SI 0.0000000000 0.0000000000 1.0376296426 O 0.0000000000 0.0000000000 -1.8158565989
c_s spin 0 C 0.0000000000 0.0000000000 1.4513095586 S 0.0000000000 0.0000000000 -1.4513095586
s_o spin 2 S 0.0000000000 0.0000000000 0.9331466927 O 0.0000000000 0.0000000000 -1.8662933855
cl_o spin 1 CL 0.0000000000 0.0000000000 1.4815451744 O 0.0000000000 0.0000000000 -1.4815451744
cl_f spin 0 CL 0.0000000000 0.0000000000 1.5382369540 F 0.0000000000 0.0000000000 -1.5382369540
si2_h6 spin 0 SI 0.0000000000 0.0000000000 -2.2115557721 SI 0.0000000000 0.0000000000 2.2115557721 H -2.2717107717 -1.3115728255 3.1851066961 H 2.2717107717 -1.3115728255 3.1851066961 H 0.0000000000 -2.6231456511 -3.1851066961 H 2.2717107717 1.3115728255 -3.1851066961 H -2.2717107717 1.3115728255 -3.1851066961 H 0.0000000000 2.6231456511 3.1851066961
c_h3_cl spin 0 C 0.0000000000 0.0000000000 -2.1213308048 H -0.9712407341 1.6822382978 -2.7675093782 H -0.9712407341 -1.6822382978 -2.7675093782 H 1.9424814681 0.0000000000 -2.7675093782 CL 0.0000000000 0.0000000000 1.2370902206
h3_c_s_h spin 0 H 2.4151850856 -1.5678281732 0.0000000000 H -2.0620727773 2.7522536203 0.0000000000 H 0.8159421075 2.9203504161 -1.6837534140 H 0.8159421075 2.9203504161 1.6837534140 C -0.0902268570 2.1733908660 0.0000000000 S -0.0902268570 -1.2540920853 0.0000000000
h_o_cl spin 0 H -1.7072351491 2.4777898178 0.0000000000 O 0.0682946972 2.0711396825 0.0000000000 CL 0.0682946972 -1.1204185381 0.0000000000
s_o2 spin 0 S 0.0000000000 0.0000000000 0.0000000000 O 0.0000000000 -2.3377800194 1.3634373001 O 0.0000000000 2.3377800194 1.3634373001
"""

def input():
    return input_string

# Define a function to parse each line and extract relevant data
def parse_line(line):
    match = re.match(r"(\w+)\s+spin\s+(\d+)\s+(.+)", line)
    if match:
        system_name = match.group(1)
        spin = int(match.group(2))
        coordinates = match.group(3).split()
        atoms = [(coordinates[i], float(coordinates[i + 1]), float(coordinates[i + 2]), float(coordinates[i + 3]))
                 for i in range(0, len(coordinates), 4)]
        return system_name, spin, atoms
    return None


# List of basis sets

# Function to create a PySCF molecule and perform Hartree-Fock calculation


if __name__ == '__main__':
    # Splitting the input string by lines
    lines = input_string.strip().split('\n')

    # Initialize an empty dictionary to store the geometries
    geometries = {}

    # Process each line and store the data in the dictionary
    current_system = None
    for line in lines:
        parsed_data = parse_line(line)
        if parsed_data:
            current_system = parsed_data[0]
            geometries[current_system] = {
                'spin': parsed_data[1],
                'atoms': parsed_data[2]
            }
        else:
            if current_system:
                # Append additional atoms to the current system
                coordinates = line.split()
                atoms = [
                    (coordinates[i], float(coordinates[i + 1]), float(coordinates[i + 2]), float(coordinates[i + 3]))
                    for i in range(0, len(coordinates), 4)]
                geometries[current_system]['atoms'].extend(atoms)

    # Display the parsed geometries
    for system, data in geometries.items():
        print(f"System: {system}")
        print(f"  Spin: {data['spin']}")
        for atom in data['atoms']:
            print(f"  Atom: {atom[0]}  Coordinates: ({atom[1]}, {atom[2]}, {atom[3]})")

    basis_sets = {'2z':'cc-pVDZ', '3z':'cc-pVTZ', '4z':'cc-pVQZ', '5z':'cc-pV5Z',
                  'vdz':'cc-pVDZ', 'vtz':'cc-pVTZ', 'vqz':'cc-pVQZ', 'v5z':'cc-pV5Z'}

    geos = geometries.items()
    results = {}
    i = 0
    for system_name, system_data in geos:
        i+=1
        atom_str = ''
        # Retrieve atoms and their positions from system data
        atom_list = system_data['atoms']
        spin = system_data['spin']

        for atom in atom_list:
            atom_str += f'{atom[0]} {atom[1]} {atom[2]} {atom[3]};'

        for basis in ['cc-pVDZ', 'cc-pVTZ', 'cc-pVQZ','cc-pV5Z']:
            system_code = system_name + "_" + basis
            results[system_code] = {}


            # Construct the atom string required by PySCF

            # Create the molecule object with the specified basis and spin
            mol = gto.M(atom=atom_str, basis=basis, spin=spin)

            # Choose the right Hartree-Fock method based on the spin
            mf = scf.RHF(mol) if spin == 0 else scf.UHF(mol)

            # Perform the calculation
            energy = mf.kernel()

            # Save the results to a checkpoint file
            chkfile = f'{system_code}_chkfile.chk'
            mf.chkfile = chkfile
            mf.init_guess = 'chkfile'
            mf.kernel()

            results[system_code][basis] = energy
            print(f"System: {system_name}, Basis: {basis}, Hartree-Fock Energy: {energy}")
        print(i)

    print('Done!')